<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dependency Tree Diff</title>

  <script src="https://cdn.jsdelivr.net/npm/counterapi/dist/counter.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dom-to-image-more@3.4.0/dist/dom-to-image-more.min.js"></script>

  <!-- Prism -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

  <!-- App CSS -->
  <link rel="stylesheet" href="./css/styles.css" />
</head>

<body>
  <main class="container">

    <header class="header">

      <!-- 방문자 카운터 (오른쪽 상단) -->
      <div class="view-counter" aria-label="페이지 방문자 수">
        <span class="counter-label">Total</span>
        <span id="total-count" class="counter-value">-</span>
      </div>

      <br>

      <h1>Dependency Tree Diff</h1>
      <p>Android 의존성 그래프 변경사항을 쉽게 비교해보세요</p>


    </header>

    <section class="card upload">

      <!-- 동적 경고 배너 (초기엔 숨김) -->
      <div id="notice" class="notice hidden" aria-live="polite">
        ⚠️ 파일이 너무 크면 비교 결과가 일부만 표시되거나 느려질 수 있습니다.
      </div>

      <div id="error" class="error"></div>
      <div class="grid">
        <div class="field">
          <label for="file-old">기존 의존성 파일 (.txt)</label>
          <div class="drop" id="drop-old" role="button" aria-label="기존 파일 선택">
            <input class="file-input" id="file-old" type="file" accept=".txt" />
            <div class="hint">클릭 또는 드래그하여 업로드</div>
            <div class="name" id="name-old" aria-live="polite"></div>
          </div>
        </div>
        <div class="field">
          <label for="file-new">변경된 의존성 파일 (.txt)</label>
          <div class="drop" id="drop-new" role="button" aria-label="변경된 파일 선택">
            <input class="file-input" id="file-new" type="file" accept=".txt" />
            <div class="hint">클릭 또는 드래그하여 업로드</div>
            <div class="name" id="name-new" aria-live="polite"></div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="btn-compare" disabled>
          <span id="btn-label">비교하기</span>
          <span id="spinner" class="spinner" style="display:none"></span>
        </button>
        <button class="btn btn-secondary" id="btn-reset" type="button">초기화</button>
      </div>

    </section>

    <section class="card result" id="result-card" style="display:none">
      <div class="result-header">
        <h2 class="result-title">비교 결과</h2>
        <div class="result-actions">
          <button class="btn btn-secondary" id="btn-copy" type="button">결과 복사</button>
          <button class="btn btn-secondary" id="btn-screenshot" type="button">스크린샷 저장</button>
          <button class="btn btn-secondary" id="btn-md-download" type="button">마크다운으로 저장</button>
        </div>
      </div>
      
      <!-- 탭 메뉴 -->
      <div class="diff-tabs">
        <button class="tab-btn active" data-tab="enhanced">전체 출력</button>
        <button class="tab-btn" data-tab="only-diff">변경된 부분만 출력</button>
        <button class="tab-btn" data-tab="flattened">요약</button>
      </div>
      
      <!-- 탭 컨텐츠 -->
      <div class="tab-content active" id="tab-enhanced">
        <div class="tab-description">
          <p>일반적인 파일 diff처럼 모든 내용을 보여줍니다.</p>
        </div>
        <div class="code-wrap" id="capture-area-enhanced">
          <pre><code class="language-diff" id="code-diff-enhanced"></code></pre>
        </div>
      </div>
      
      <div class="tab-content" id="tab-only-diff">
        <div class="tab-description">
          <p>추가되거나 삭제된 의존성만 표시합니다.</p>
        </div>
        <div class="code-wrap" id="capture-area-only-diff">
          <pre><code class="language-diff" id="code-diff-only-diff"></code></pre>
        </div>
      </div>
      
      <div class="tab-content" id="tab-flattened">
        <div class="tab-description">
          <p>추가/삭제/변경된 의존성을 카테고리별로 정리합니다.</p>
        </div>
        <div class="code-wrap" id="capture-area-flattened">
          <pre><code class="language-diff" id="code-diff-flattened"></code></pre>
        </div>
      </div>
    </section>

    <section class="guide-section" id="guide-deptree" style="display:block">
      <button class="guide-toggle" type="button" aria-expanded="false">
        📘 의존성 트리 출력 방법
      </button>

      <div class="guide-content" style="display:none">
        <ol class="guide-steps">
          <li class="guide-step">
            <div class="guide-step-title">1. 변경 전 의존성 출력</div>
            <div class="guide-note">현재 <strong>develop</strong> 브랜치 또는 변경 전 브랜치에서 실행하세요.</div>
            <div class="guide-block">
              <div class="guide-label">명령어</div>
              <pre
                class="guide-code"><code>./gradlew app:dependencies --configuration {BuildVariant명}RuntimeClassPath > before.txt</code></pre>
            </div>
            <ul class="config-info">
              <li><strong>RuntimeClassPath</strong>: 실제 앱 실행 시 필요한 의존성 (APK에 포함되는 라이브러리들)</li>
              <li><strong>CompileClassPath</strong>: 컴파일 시에만 필요한 의존성 (API, annotation processor 등)</li>
              <li>💡 실제 앱 의존성 확인 시 <code>RuntimeClassPath</code> 권장</li>
            </ul>
          </li>

          <li class="guide-step">
            <div class="guide-step-title">2. 변경 후 의존성 출력</div>
            <div class="guide-note">브랜치 변경 후 <strong>파일명만 다르게</strong> 저장하세요.</div>
            <div class="guide-block">
              <div class="guide-label">명령어</div>
              <pre
                class="guide-code"><code>./gradlew app:dependencies --configuration {BuildVariant명}RuntimeClassPath > after.txt</code></pre>
            </div>
          </li>

          <li class="guide-step">
            <div class="guide-step-title">3. 비교하기</div>
            <div class="guide-note"><code>before.txt</code>와 <code>after.txt</code>를 업로드해보세요.</div>
          </li>
        </ol>
      </div>
    </section>
  </main>

  <script defer src="./js/visitor-counter.js"></script>
  <!-- Core (diff 로직) 먼저 로드 -->
  <script defer src="./js/dependency-only-diff.js"></script> 
  <script defer src="./js/dependency-diff-flattened.js"></script>
  <script defer src="./js/dependency-diff-tree-full-enhanced.js"></script>
  <!-- UI -->
  <script defer src="./js/app.js"></script>

  <script defer src="./js/result-capture.js"></script>
  <script defer src="./js/result-markdown.js"></script>
</body>

</html>